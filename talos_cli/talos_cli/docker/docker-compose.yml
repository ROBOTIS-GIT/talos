# Packaged compose for pip-installed talos_cli.
# Uses pre-built images; config path is set via TALOS_CONFIG_FILE by the CLI.
services:
  rmw_zenoh:
    container_name: zenoh_daemon
    image: robotis/zenoh-daemon:latest
    restart: always
    network_mode: host
    init: true

  talos:
    container_name: talos
    image: robotis/talos:latest
    restart: always
    network_mode: host
    volumes:
      - /var/run/robotis/agent_sockets:/agents
      - ${TALOS_CONFIG_FILE}:/app/config.yml
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - CONFIG_FILE=/app/config.yml

  ui:
    container_name: talos_ui
    image: robotis/talos-ui:latest
    restart: always
    network_mode: host
    environment:
      - NEXT_PUBLIC_API_URL=http://127.0.0.1:8081
      - NODE_ENV=production

  novnc-server:
    container_name: novnc-server
    image: robotis/novnc-server:latest
    restart: always
    cap_add:
      - SYS_NICE
    ulimits:
      rtprio: 99
      rttime: -1
      memlock: 8428281856
    network_mode: host
    environment:
      - ROS_DOMAIN_ID=30
      - DISPLAY=:99
      - DISPLAY_WIDTH=1920
      - DISPLAY_HEIGHT=1080
      - WEBSOCKIFY_PORT=8090
    volumes:
      - /dev:/dev
      - /dev/shm:/dev/shm
    privileged: true
