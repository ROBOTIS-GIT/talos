[supervisord]
nodaemon=true

# XTerm (virtual display)
[program:xterm]
command=xterm
autorestart=true
autostart=false

[program:xvfb]
command=Xvfb %(ENV_DISPLAY)s -screen 0 "%(ENV_DISPLAY_WIDTH)s"x"%(ENV_DISPLAY_HEIGHT)s"x24 -listen tcp -ac
autorestart=true

[program:fluxbox]
command=fluxbox
autorestart=true

[program:pcmanfm]
command=/usr/bin/pcmanfm --desktop --profile fluxbox
environment=DISPLAY=":0"
autorestart=true

[program:x11vnc]
command=x11vnc -forever -shared
autorestart=true

[program:websockify]
command=websockify --web /usr/share/novnc %(ENV_WEBSOCKIFY_PORT)s localhost:5900
autorestart=true
# [supervisord]
# nodaemon=true
# user=root

# # 1. 가상 모니터 (가장 먼저 켜져야 함 - Priority 10)
# [program:xvfb]
# # -ac 옵션(접근 제어 끄기) 필수
# command=/usr/bin/Xvfb %(ENV_DISPLAY)s -screen 0 "%(ENV_DISPLAY_WIDTH)s"x"%(ENV_DISPLAY_HEIGHT)s"x24 -listen tcp -ac
# autorestart=true
# priority=10

# # 2. 윈도우 매니저 (Priority 20)
# [program:fluxbox]
# command=fluxbox
# environment=DISPLAY="%(ENV_DISPLAY)s"
# autorestart=true
# priority=20

# # 3. 바탕화면/아이콘 관리 (Priority 30)
# [program:pcmanfm]
# # fluxbox가 켜진 뒤 실행. 프로필 지정.
# command=/usr/bin/pcmanfm --desktop --profile fluxbox
# environment=DISPLAY="%(ENV_DISPLAY)s"
# autorestart=true
# priority=30

# # 4. VNC 서버 (Priority 40 - 가장 중요!)
# [program:x11vnc]
# # sleep 3: Xvfb와 Fluxbox가 완전히 뜰 때까지 3초 대기 (충돌 방지 핵심)
# # -display: 명시적 지정
# # -nopw: 비밀번호 없이 접속
# # -noxdamage: 그래픽 깨짐 방지
# command=bash -c "sleep 3 && /usr/bin/x11vnc -display %(ENV_DISPLAY)s -forever -shared -nopw -listen localhost -xkb -noxdamage"
# autorestart=true
# priority=40

# # 5. 웹 프록시 (Priority 50)
# [program:websockify]
# command=websockify --web /usr/share/novnc %(ENV_WEBSOCKIFY_PORT)s localhost:5900
# autorestart=true
# priority=50

# # (선택) 터미널은 필요할 때만 켜지도록 설정 유지
# [program:xterm]
# command=xterm
# environment=DISPLAY="%(ENV_DISPLAY)s"
# autorestart=true
# autostart=false
