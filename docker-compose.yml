services:
  rmw_zenoh:
    container_name: zenoh_daemon
    image: robotis/zenoh-daemon:latest
    restart: always
    network_mode: host
    init: true

  talos:
    container_name: talos
    build:
      context: .
      dockerfile: talos/Dockerfile
    image: robotis/talos:latest
    restart: always
    network_mode: host
    volumes:
      # Mount agent sockets directory (read-only for talos)
      - /var/run/robotis/agent_sockets:/agents
      # Mount config file
      - ./config.yml:/app/config.yml
      # Mount Docker socket for Docker API access
      - /var/run/docker.sock:/var/run/docker.sock
      - ./talos:/app/talos
    environment:
      - CONFIG_FILE=/app/config.yml
    # Note: This service can run independently, but requires agent sockets
    # to be created by the ai_worker container first

  ui:
    container_name: talos_ui
    build:
      context: ./talos_ui
      dockerfile: Dockerfile
    restart: always
    network_mode: host
    environment:
      - NEXT_PUBLIC_API_URL=http://127.0.0.1:8081
      - NODE_ENV=production
    # Note: UI uses host network mode to communicate with talos
    # If talos is on a Docker network, change network_mode and
    # set NEXT_PUBLIC_API_URL to http://talos:8081
